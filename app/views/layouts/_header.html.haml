%header.navbar
  %div.container
    #{ link_to "PopcornPal", root_path, class: "navbar-brand" }
    - if current_user
      %ul.nav.navbar-nav.navbar-form
        %li.form-group.has-feedback
          %input.form.typeahead{ type:"text", placeholder:"Search movies" }
          %span.glyphicon.form-control-feedback.typeahead-icon.glyphicon-search
          %span.glyphicon.form-control-feedback.typeahead-spinner.glyphicon-refresh{ style:"display: none" }
      %ul.nav.navbar-nav.navbar-right
        %li.dropdown
          %a.dropdown-toggle{ href: '#tab2', data: { toggle: 'dropdown' } }
            %img.header-profile-pic{src:"#{ gravatar_url current_user }"}
          %ul.dropdown-menu
            %li
              #{ link_to "Edit profile", { controller: "devise/registrations", action: "edit" } }
            %li
              #{ link_to "Log out", destroy_user_session_path,  method: :delete }
    - else
      %div.nav.navbar-nav.navbar-right
        #{ link_to "Log in", new_user_session_path }
        | #{ link_to "Sign up", new_user_registration_path }

:javascript
  // Instantiate the Bloodhound suggestion engine
  var movies = new Bloodhound({
    datumTokenizer: function (datum) {
      return Bloodhound.tokenizers.whitespace(datum.value);
    },
    queryTokenizer: Bloodhound.tokenizers.whitespace,
    remote: {
      wildcard: '%QUERY',
      url: 'https://www.omdbapi.com/?s=%QUERY&type=movie',
      transform: function (movies) {
        return $.map(movies["Search"], function (movie) {
          return {
            title: movie["Title"],
            year: movie["Year"],
            posterUrl: movie["Poster"],
            imdbID: movie["imdbID"]
          };
        });
      }
    }
  });
  
  // Initialize the Bloodhound suggestion engine
  movies.initialize();
  
  // Instantiate the Typeahead UI
  $('.typeahead').typeahead({
    hint: false
  },
  {
    name: 'movies',
    display: 'title',
    source: movies.ttAdapter(),
    minLength: 1,
    limit: 3,
    templates: {
      notFound: '<div>No Results Found</div>',
      suggestion: function (movies) {
          return '<li><img class="movie-thumbnail" src="' + movies.posterUrl + '"></img><strong><a>' + movies.title + '</a></strong> (' + movies.year + ')</li>';
        }
    }
  }).on('typeahead:asyncrequest', function() {
    $('.typeahead-spinner').show();
    $('.typeahead-icon').hide();
  })
  .on('typeahead:asynccancel typeahead:asyncreceive', function() {
      $('.typeahead-spinner').hide();
      $('.typeahead-icon').show();
  });
